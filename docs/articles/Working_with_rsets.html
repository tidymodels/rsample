<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with rsets • rsample</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Working with rsets">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">rsample</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/Basics.html">Basic Usage</a>
</li>
<li>
  <a href="../articles/Working_with_rsets.html">Working with Resample Sets</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Application Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Applications/Recipes_and_rsample.html">Recipes and rsample</a>
    </li>
    <li>
      <a href="../articles/Applications/Time_Series.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="../articles/Applications/Survival_Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="../articles/Applications/Nested_Resampling.html">Tuning Models using Nested Resampling</a>
    </li>
    <li>
      <a href="../articles/Applications/Keras.html">Grid Search Tuning of Keras Models</a>
    </li>
    <li>
      <a href="../reference/index.html">Reference</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Working with rsets</h1>
            
      
      
      <div class="hidden name"><code>Working_with_rsets.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>rsample</code> can be used to create objects containing resamples of the original data. This page contains examples of how those objects can be used for data analysis.</p>
<p>For illustration, the <code>attrition</code> data is used. From the help file:</p>
<blockquote>
<p>These data are from the IBM Watson Analytics Lab. The website describes the data with “Uncover the factors that lead to employee attrition and explore important questions such as ‘show me a breakdown of distance from home by job role and attrition’ or ‘compare average monthly income by education and attrition’. This is a fictional data set created by IBM data scientists.” There are 1470 rows.</p>
</blockquote>
<p>The data can be accessed using</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rsample)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"attrition"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(attrition)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;  [1] "Age"                      "Attrition"                "BusinessTravel"          </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;  [4] "DailyRate"                "Department"               "DistanceFromHome"        </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;  [7] "Education"                "EducationField"           "EnvironmentSatisfaction" </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; [10] "Gender"                   "HourlyRate"               "JobInvolvement"          </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt; [13] "JobLevel"                 "JobRole"                  "JobSatisfaction"         </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; [16] "MaritalStatus"            "MonthlyIncome"            "MonthlyRate"             </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; [19] "NumCompaniesWorked"       "OverTime"                 "PercentSalaryHike"       </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; [22] "PerformanceRating"        "RelationshipSatisfaction" "StockOptionLevel"        </span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; [25] "TotalWorkingYears"        "TrainingTimesLastYear"    "WorkLifeBalance"         </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; [28] "YearsAtCompany"           "YearsInCurrentRole"       "YearsSinceLastPromotion" </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; [31] "YearsWithCurrManager"</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span>(attrition<span class="op">$</span>Attrition)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;   No  Yes </span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; 1233  237</span></a></code></pre></div>
</div>
<div id="model-assessment" class="section level2">
<h2 class="hasAnchor">
<a href="#model-assessment" class="anchor"></a>Model Assessment</h2>
<p>Let’s fit a logistic regression model to the data with model terms for the job satisfaction, gender, and monthly income.</p>
<p>If we were fitting the model to the entire data set, we might model attrition using</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(Attrition <span class="op">~</span><span class="st"> </span>JobSatisfaction <span class="op">+</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>MonthlyIncome, <span class="dt">data =</span> attrition, <span class="dt">family =</span> binomial)</a></code></pre></div>
<p>For convenience, we’ll create a formula object that will be used later:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mod_form &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(Attrition <span class="op">~</span><span class="st"> </span>JobSatisfaction <span class="op">+</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>MonthlyIncome)</a></code></pre></div>
<p>To evaluate this model, we will use 10 repeats of 10-fold cross-validation and use the 100 holdout samples to evaluate the overall accuracy of the model.</p>
<p>First, let’s make the splits of the data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rsample)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">4622</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">rs_obj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vfold_cv.html">vfold_cv</a></span>(attrition, <span class="dt">v =</span> <span class="dv">10</span>, <span class="dt">repeats =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">rs_obj</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; #  10-fold cross-validation repeated 10 times </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; # A tibble: 100 x 3</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;    splits             id       id2   </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;    &lt;named list&gt;       &lt;chr&gt;    &lt;chr&gt; </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;  1 &lt;split [1.3K/147]&gt; Repeat01 Fold01</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;  2 &lt;split [1.3K/147]&gt; Repeat01 Fold02</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  3 &lt;split [1.3K/147]&gt; Repeat01 Fold03</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  4 &lt;split [1.3K/147]&gt; Repeat01 Fold04</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  5 &lt;split [1.3K/147]&gt; Repeat01 Fold05</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;  6 &lt;split [1.3K/147]&gt; Repeat01 Fold06</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;  7 &lt;split [1.3K/147]&gt; Repeat01 Fold07</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;  8 &lt;split [1.3K/147]&gt; Repeat01 Fold08</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt;  9 &lt;split [1.3K/147]&gt; Repeat01 Fold09</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; 10 &lt;split [1.3K/147]&gt; Repeat01 Fold10</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; # … with 90 more rows</span></a></code></pre></div>
<p>Now let’s write a function that will, for each resample:</p>
<ol style="list-style-type: decimal">
<li>obtain the analysis data set (i.e. the 90% used for modeling)</li>
<li>fit a logistic regression model</li>
<li>predict the assessment data (the other 10% not used for the model) using the <code>broom</code> package</li>
<li>determine if each sample was predicted correctly.</li>
</ol>
<p>Here is our function:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">## splits will be the `rsplit` object with the 90/10 partition</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">holdout_results &lt;-<span class="st"> </span><span class="cf">function</span>(splits, ...) {</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="co"># Fit the model to the 90%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(..., <span class="dt">data =</span> <span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits), <span class="dt">family =</span> binomial)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="co"># Save the 10%</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  holdout &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.data.frame.rsplit.html">assessment</a></span>(splits)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="co"># `augment` will save the predictions with the holdout data set</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  res &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">augment</a></span>(mod, <span class="dt">newdata =</span> holdout)</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="co"># Class predictions on the assessment set from class probs</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  lvls &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(holdout<span class="op">$</span>Attrition)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  predictions &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(res<span class="op">$</span>.fitted <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, lvls[<span class="dv">2</span>], lvls[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">                        <span class="dt">levels =</span> lvls)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  <span class="co"># Calculate whether the prediction was correct</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">  res<span class="op">$</span>correct &lt;-<span class="st"> </span>predictions <span class="op">==</span><span class="st"> </span>holdout<span class="op">$</span>Attrition</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  <span class="co"># Return the assessment data set with the additional columns</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  res</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">}</a></code></pre></div>
<p>For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">example &lt;-<span class="st"> </span><span class="kw">holdout_results</span>(rs_obj<span class="op">$</span>splits[[<span class="dv">1</span>]],  mod_form)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(example)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] 147  35</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw"><a href="../reference/as.data.frame.rsplit.html">assessment</a></span>(rs_obj<span class="op">$</span>splits[[<span class="dv">1</span>]]))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [1] 147  31</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">## newly added columns:</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">example[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(example), <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(attrition))]</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; # A tibble: 10 x 4</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt;    .rownames .fitted .se.fit correct</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt; &lt;lgl&gt;  </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt;  1 11          -1.20   0.155 TRUE   </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt;  2 24          -1.78   0.166 TRUE   </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;  3 30          -1.45   0.183 TRUE   </span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt;  4 39          -1.60   0.172 TRUE   </span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt;  5 53          -1.54   0.176 TRUE   </span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt;  6 72          -1.93   0.190 TRUE   </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="co">#&gt;  7 73          -3.06   0.266 TRUE   </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="co">#&gt;  8 80          -3.28   0.346 TRUE   </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="co">#&gt;  9 83          -2.23   0.199 TRUE   </span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="co">#&gt; 10 90          -1.28   0.151 FALSE</span></a></code></pre></div>
<p>For this model, the <code>.fitted</code> value is the linear predictor in log-odds units.</p>
<p>To compute this data set for each of the 100 resamples, we’ll use the <code>map</code> function from the <code>purrr</code> package:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">rs_obj<span class="op">$</span>results &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(rs_obj<span class="op">$</span>splits,</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">                      holdout_results,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">                      mod_form)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">rs_obj</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; #  10-fold cross-validation repeated 10 times </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; # A tibble: 100 x 4</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;    splits             id       id2    results            </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;    &lt;named list&gt;       &lt;chr&gt;    &lt;chr&gt;  &lt;named list&gt;       </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  1 &lt;split [1.3K/147]&gt; Repeat01 Fold01 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  2 &lt;split [1.3K/147]&gt; Repeat01 Fold02 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  3 &lt;split [1.3K/147]&gt; Repeat01 Fold03 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  4 &lt;split [1.3K/147]&gt; Repeat01 Fold04 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  5 &lt;split [1.3K/147]&gt; Repeat01 Fold05 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  6 &lt;split [1.3K/147]&gt; Repeat01 Fold06 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;  7 &lt;split [1.3K/147]&gt; Repeat01 Fold07 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;  8 &lt;split [1.3K/147]&gt; Repeat01 Fold08 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;  9 &lt;split [1.3K/147]&gt; Repeat01 Fold09 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; 10 &lt;split [1.3K/147]&gt; Repeat01 Fold10 &lt;tibble [147 × 35]&gt;</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt; # … with 90 more rows</span></a></code></pre></div>
<p>Now we can compute the accuracy values for all of the assessment data sets:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">rs_obj<span class="op">$</span>accuracy &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(rs_obj<span class="op">$</span>results, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(x<span class="op">$</span>correct))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_obj<span class="op">$</span>accuracy)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;   0.776   0.821   0.840   0.839   0.859   0.905</span></a></code></pre></div>
<p>Keep in mind that the baseline accuracy to beat is the rate of non-attrition, which is 0.839. Not a great model so far.</p>
</div>
<div id="using-the-bootstrap-to-make-comparisons" class="section level2">
<h2 class="hasAnchor">
<a href="#using-the-bootstrap-to-make-comparisons" class="anchor"></a>Using the Bootstrap to Make Comparisons</h2>
<p>Traditionally, the bootstrap has been primarily used to empirically determine the sampling distribution of a test statistic. Given a set of samples with replacement, a statistic can be calculated on each analysis set and the results can be used to make inferences (such as confidence intervals).</p>
<p>For example, are there differences in the median monthly income between genders?</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">ggplot</span>(attrition, <span class="kw">aes</span>(<span class="dt">x =</span> Gender, <span class="dt">y =</span> MonthlyIncome)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_y_log10</span>()</a></code></pre></div>
<p><img src="Working_with_rsets_files/figure-html/type_plot-1.png" width="768"></p>
<p>If we wanted to compare the genders, we could conduct a <em>t</em>-test or rank-based test. Instead, let’s use the bootstrap to see if there is a difference in the median incomes for the two groups. We need a simple function to compute this statistic on the resample:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">median_diff &lt;-<span class="st"> </span><span class="cf">function</span>(splits) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(x<span class="op">$</span>MonthlyIncome[x<span class="op">$</span>Gender <span class="op">==</span><span class="st"> "Female"</span>]) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">      </span><span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(x<span class="op">$</span>MonthlyIncome[x<span class="op">$</span>Gender <span class="op">==</span><span class="st"> "Male"</span>])     </a>
<a class="sourceLine" id="cb10-5" data-line-number="5">}</a></code></pre></div>
<p>Now we would create a large number of bootstrap samples (say 2000+). For illustration, we’ll only do 500 in this document.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">353</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">bt_resamples &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bootstraps.html">bootstraps</a></span>(attrition, <span class="dt">times =</span> <span class="dv">500</span>)</a></code></pre></div>
<p>This function is then computed across each resample:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">bt_resamples<span class="op">$</span>wage_diff &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span>(bt_resamples<span class="op">$</span>splits, median_diff)</a></code></pre></div>
<p>The bootstrap distribution of this statistic has a slightly bimodal and skewed distribution:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">ggplot</span>(bt_resamples, <span class="kw">aes</span>(<span class="dt">x =</span> wage_diff)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">"density"</span>, <span class="dt">adjust =</span> <span class="fl">1.25</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Difference in Median Monthly Income (Female - Male)"</span>)</a></code></pre></div>
<p><img src="Working_with_rsets_files/figure-html/stats_plot-1.png" width="768"></p>
<p>The variation is considerable in this statistic. One method of computing a confidence interval is to take the percentiles of the bootstrap distribution. A 95% confidence interval for the difference in the means would be:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(bt_resamples<span class="op">$</span>wage_diff, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">         <span class="dt">probs =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.500</span>, <span class="fl">0.975</span>))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt;  2.5%   50% 97.5% </span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt;  -189   262   615</span></a></code></pre></div>
<p><em>On average</em>, there is no evidence for a difference in the genders.</p>
</div>
<div id="bootstrap-estimates-of-model-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrap-estimates-of-model-coefficients" class="anchor"></a>Bootstrap Estimates of Model Coefficients</h2>
<p>Unless there is already a column in the resample object that contains the fitted model, a function can be used to fit the model and save all of the model coefficients. The <a href="https://cran.r-project.org/package=broom"><code>broom</code> package</a> package has a <code>tidy</code> function that will save the coefficients in a data frame. Instead of returning a data frame with a row for each model term, we will save a data frame with a single row and columns for each model term. As before, <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> can be used to estimate and save these values for each split.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">glm_coefs &lt;-<span class="st"> </span><span class="cf">function</span>(splits, ...) {</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  ## use `analysis` or `as.data.frame` to get the analysis data</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  mod &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(..., <span class="dt">data =</span> <span class="kw"><a href="../reference/as.data.frame.rsplit.html">analysis</a></span>(splits), <span class="dt">family =</span> binomial)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(mod)))</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">bt_resamples<span class="op">$</span>betas &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="dt">.x =</span> bt_resamples<span class="op">$</span>splits, </a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                          <span class="dt">.f =</span> glm_coefs, </a>
<a class="sourceLine" id="cb15-8" data-line-number="8">                          mod_form)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">bt_resamples</a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; # Bootstrap sampling </span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; # A tibble: 500 x 4</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt;    splits             id           wage_diff betas           </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt;            &lt;dbl&gt; &lt;list&gt;          </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt;  1 &lt;split [1.5K/558]&gt; Bootstrap001      136  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt;  2 &lt;split [1.5K/528]&gt; Bootstrap002      282. &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt;  3 &lt;split [1.5K/541]&gt; Bootstrap003      470  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;  4 &lt;split [1.5K/561]&gt; Bootstrap004     -213  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt;  5 &lt;split [1.5K/518]&gt; Bootstrap005      453  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt;  6 &lt;split [1.5K/539]&gt; Bootstrap006      684  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">#&gt;  7 &lt;split [1.5K/542]&gt; Bootstrap007       60  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt;  8 &lt;split [1.5K/536]&gt; Bootstrap008      286  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22"><span class="co">#&gt;  9 &lt;split [1.5K/552]&gt; Bootstrap009      -30  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">#&gt; 10 &lt;split [1.5K/517]&gt; Bootstrap010      410  &lt;df[,6] [1 × 6]&gt;</span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24"><span class="co">#&gt; # … with 490 more rows</span></a>
<a class="sourceLine" id="cb15-25" data-line-number="25">bt_resamples<span class="op">$</span>betas[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="co">#&gt;   (Intercept) JobSatisfaction.L JobSatisfaction.Q JobSatisfaction.C GenderMale</span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="co">#&gt; 1      -0.939            -0.501            -0.272            0.0842     0.0989</span></a>
<a class="sourceLine" id="cb15-28" data-line-number="28"><span class="co">#&gt;   MonthlyIncome</span></a>
<a class="sourceLine" id="cb15-29" data-line-number="29"><span class="co">#&gt; 1     -0.000129</span></a></code></pre></div>
</div>
<div id="keeping-tidy" class="section level2">
<h2 class="hasAnchor">
<a href="#keeping-tidy" class="anchor"></a>Keeping Tidy</h2>
<p>As previously mentioned, the <a href="https://cran.r-project.org/package=broom"><code>broom</code> package</a> contains a class called <code>tidy</code> that created representations of objects that can be easily used for analysis, plotting, etc. <code>rsample</code> contains <code>tidy</code> methods for <code>rset</code> and <code>rsplit</code> objects. For example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">first_resample &lt;-<span class="st"> </span>bt_resamples<span class="op">$</span>splits[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(first_resample)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; [1] "rsplit"     "boot_split"</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span>(first_resample)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; # A tibble: 1,470 x 2</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt;      Row Data    </span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt;  1     2 Analysis</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt;  2     3 Analysis</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt;  3     4 Analysis</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt;  4     7 Analysis</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt;  5     9 Analysis</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt;  6    10 Analysis</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt;  7    11 Analysis</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt;  8    13 Analysis</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt;  9    18 Analysis</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; 10    19 Analysis</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; # … with 1,460 more rows</span></a></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span>(bt_resamples)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; [1] "bootstraps" "rset"       "tbl_df"     "tbl"        "data.frame"</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span>(bt_resamples)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt; # A tibble: 735,000 x 3</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt;      Row Data     Resample    </span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;       </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt;  1     1 Analysis Bootstrap002</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt;  2     1 Analysis Bootstrap004</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;  3     1 Analysis Bootstrap007</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;  4     1 Analysis Bootstrap008</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;  5     1 Analysis Bootstrap009</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;  6     1 Analysis Bootstrap010</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;  7     1 Analysis Bootstrap011</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;  8     1 Analysis Bootstrap013</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt;  9     1 Analysis Bootstrap015</span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt; 10     1 Analysis Bootstrap016</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt; # … with 734,990 more rows</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#model-assessment">Model Assessment</a></li>
      <li><a href="#using-the-bootstrap-to-make-comparisons">Using the Bootstrap to Make Comparisons</a></li>
      <li><a href="#bootstrap-estimates-of-model-coefficients">Bootstrap Estimates of Model Coefficients</a></li>
      <li><a href="#keeping-tidy">Keeping Tidy</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="tidyverse">
  <p><code>rsample</code> is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
