<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recipes with rsample • rsample</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Recipes with rsample">
<meta property="og:description" content="rsample">
<meta property="og:image" content="https://rsample.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">rsample</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.7.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/Basics.html">Basic Usage</a>
</li>
<li>
  <a href="../../articles/Working_with_rsets.html">Working with Resample Sets</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Application Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Applications/Recipes_and_rsample.html">Recipes and rsample</a>
    </li>
    <li>
      <a href="../../articles/Applications/Time_Series.html">Time Series Analysis</a>
    </li>
    <li>
      <a href="../../articles/Applications/Survival_Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="../../articles/Applications/Nested_Resampling.html">Tuning Models using Nested Resampling</a>
    </li>
    <li>
      <a href="../../articles/Applications/Keras.html">Grid Search Tuning of Keras Models</a>
    </li>
    <li>
      <a href="../../articles/Applications/Intervals.html">Bootstrap Interval Estimation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/rsample/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Recipes_and_rsample_files/header-attrs-2.3/header-attrs.js"></script><script src="Recipes_and_rsample_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Recipes with rsample</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/rsample/blob/master/vignettes/Applications/Recipes_and_rsample.Rmd"><code>vignettes/Applications/Recipes_and_rsample.Rmd</code></a></small>
      <div class="hidden name"><code>Recipes_and_rsample.Rmd</code></div>

    </div>

    
    
<p>The <a href="https://topepo.github.io/recipes/"><code>recipes</code></a> package contains a data preprocessor that can be used to avoid the potentially expensive formula methods as well as providing a richer set of data manipulation tools than base R can provide. This document uses version 0.1.13 of <code>recipes</code>.</p>
<p>In many cases, the preprocessing steps might contain quantities that require statistical estimation of parameters, such as</p>
<ul>
<li><p>signal extraction using principal component analysis</p></li>
<li><p>imputation of missing values</p></li>
<li><p>transformations of individual variables (e.g. Box-Cox transformations)</p></li>
</ul>
<p>It is critical that any complex preprocessing steps be contained <em>inside</em> of resampling so that the model performance estimates take into account the variability of these steps.</p>
<p>Before discussing how <code>rsample</code> can use recipes, let’s look at an example recipe for the Ames housing data.</p>
<div id="an-example-recipe" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example-recipe" class="anchor"></a>An Example Recipe</h2>
<p>For illustration, the Ames housing data will be used. There are sale prices of homes along with various other descriptors for the property:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/topepo/AmesHousing">AmesHousing</a></span>)
<span class="kw">ames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html">make_ames</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">ames</span>)
</pre></div>
<pre><code>##  [1] "MS_SubClass"        "MS_Zoning"          "Lot_Frontage"      
##  [4] "Lot_Area"           "Street"             "Alley"             
##  [7] "Lot_Shape"          "Land_Contour"       "Utilities"         
## [10] "Lot_Config"         "Land_Slope"         "Neighborhood"      
## [13] "Condition_1"        "Condition_2"        "Bldg_Type"         
## [16] "House_Style"        "Overall_Qual"       "Overall_Cond"      
## [19] "Year_Built"         "Year_Remod_Add"     "Roof_Style"        
## [22] "Roof_Matl"          "Exterior_1st"       "Exterior_2nd"      
## [25] "Mas_Vnr_Type"       "Mas_Vnr_Area"       "Exter_Qual"        
## [28] "Exter_Cond"         "Foundation"         "Bsmt_Qual"         
## [31] "Bsmt_Cond"          "Bsmt_Exposure"      "BsmtFin_Type_1"    
## [34] "BsmtFin_SF_1"       "BsmtFin_Type_2"     "BsmtFin_SF_2"      
## [37] "Bsmt_Unf_SF"        "Total_Bsmt_SF"      "Heating"           
## [40] "Heating_QC"         "Central_Air"        "Electrical"        
## [43] "First_Flr_SF"       "Second_Flr_SF"      "Low_Qual_Fin_SF"   
## [46] "Gr_Liv_Area"        "Bsmt_Full_Bath"     "Bsmt_Half_Bath"    
## [49] "Full_Bath"          "Half_Bath"          "Bedroom_AbvGr"     
## [52] "Kitchen_AbvGr"      "Kitchen_Qual"       "TotRms_AbvGrd"     
## [55] "Functional"         "Fireplaces"         "Fireplace_Qu"      
## [58] "Garage_Type"        "Garage_Finish"      "Garage_Cars"       
## [61] "Garage_Area"        "Garage_Qual"        "Garage_Cond"       
## [64] "Paved_Drive"        "Wood_Deck_SF"       "Open_Porch_SF"     
## [67] "Enclosed_Porch"     "Three_season_porch" "Screen_Porch"      
## [70] "Pool_Area"          "Pool_QC"            "Fence"             
## [73] "Misc_Feature"       "Misc_Val"           "Mo_Sold"           
## [76] "Year_Sold"          "Sale_Type"          "Sale_Condition"    
## [79] "Sale_Price"         "Longitude"          "Latitude"</code></pre>
<p>Suppose that we will again fit a simple regression model with the formula:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="kw">Sale_Price</span>) <span class="op">~</span> <span class="kw">Neighborhood</span> <span class="op">+</span> <span class="kw">House_Style</span> <span class="op">+</span> <span class="kw">Year_Sold</span> <span class="op">+</span> <span class="kw">Lot_Area</span>
</pre></div>
<p>The distribution of the lot size is right-skewed:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">ames</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">Lot_Area</span>)) <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(binwidth = <span class="fl">5000</span>, col = <span class="st">"red"</span>, fill =<span class="st">"red"</span>, alpha = <span class="fl">.5</span>)
</pre></div>
<p><img src="Recipes_and_rsample_files/figure-html/build-1.png" width="768"></p>
<p>It might benefit the model if we estimate a transformation of the data using the Box-Cox procedure.</p>
<p>Also, note that the frequencies of the neighborhoods can vary:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw">ames</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">Neighborhood</span>)) <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>() <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">""</span>)
</pre></div>
<p><img src="Recipes_and_rsample_files/figure-html/hood-1.png" width="768"></p>
<p>When these are resampled, some neighborhoods will not be included in the test set and this will result in a column of dummy variables with zero entires. The same is true for the <code>House_Style</code> variable. We might want to collapse rarely occurring values into “other” categories.</p>
<p>To define the design matrix, an initial recipe is created:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/recipes">recipes</a></span>)

<span class="kw">rec</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span>(<span class="kw">Sale_Price</span> <span class="op">~</span> <span class="kw">Neighborhood</span> <span class="op">+</span> <span class="kw">House_Style</span> <span class="op">+</span> <span class="kw">Year_Sold</span> <span class="op">+</span> <span class="kw">Lot_Area</span>, 
         data = <span class="kw">ames</span>) <span class="op">%&gt;%</span>
  <span class="co"># Log the outcome</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_log.html">step_log</a></span>(<span class="kw">Sale_Price</span>, base = <span class="fl">10</span>) <span class="op">%&gt;%</span>
  <span class="co"># Collapse rarely occurring jobs into "other"</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_other.html">step_other</a></span>(<span class="kw">Neighborhood</span>, <span class="kw">House_Style</span>, threshold = <span class="fl">0.05</span>) <span class="op">%&gt;%</span>
  <span class="co"># Dummy variables on the qualitative predictors</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_nominal</a></span>()) <span class="op">%&gt;%</span>
  <span class="co"># Unskew a predictor</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_BoxCox.html">step_BoxCox</a></span>(<span class="kw">Lot_Area</span>) <span class="op">%&gt;%</span>
  <span class="co"># Normalize</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_center.html">step_center</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>()) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_scale.html">step_scale</a></span>(<span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>()) 
<span class="kw">rec</span>
</pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          4
## 
## Operations:
## 
## Log transformation on Sale_Price
## Collapsing factor levels for Neighborhood, House_Style
## Dummy variables from all_nominal()
## Box-Cox transformation on Lot_Area
## Centering for all_predictors()
## Scaling for all_predictors()</code></pre>
<p>This recreates the work that the formula method traditionally uses with the additional steps.</p>
<p>While the original data object <code>ames</code> is used in the call, it is only used to define the variables and their characteristics so a single recipe is valid across all resampled versions of the data. The recipe can be estimated on the analysis component of the resample.</p>
<p>If we execute the recipe on the entire data set:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">rec_training_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span>(<span class="kw">rec</span>, training = <span class="kw">ames</span>)
<span class="kw">rec_training_set</span>
</pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          4
## 
## Training data contained 2930 data points and no missing data.
## 
## Operations:
## 
## Log transformation on Sale_Price [trained]
## Collapsing factor levels for Neighborhood, House_Style [trained]
## Dummy variables from Neighborhood, House_Style [trained]
## Box-Cox transformation on Lot_Area [trained]
## Centering for Year_Sold, Lot_Area, ... [trained]
## Scaling for Year_Sold, Lot_Area, ... [trained]</code></pre>
<p>To get the values of the data, the <code>bake</code> function can be used:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># By default, the selector `everything()` is used to </span>
<span class="co"># return all the variables. Other selectors can be used too. </span>
<span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html">bake</a></span>(<span class="kw">rec_training_set</span>, new_data = <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">ames</span>))
</pre></div>
<pre><code>## # A tibble: 6 x 14
##   Year_Sold Lot_Area Sale_Price Neighborhood_Co… Neighborhood_Ol…
##       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1      1.68    2.70        5.33           -0.317           -0.298
## 2      1.68    0.506       5.02           -0.317           -0.298
## 3      1.68    0.930       5.24           -0.317           -0.298
## 4      1.68    0.423       5.39           -0.317           -0.298
## 5      1.68    0.865       5.28           -0.317           -0.298
## 6      1.68    0.197       5.29           -0.317           -0.298
## # … with 9 more variables: Neighborhood_Edwards &lt;dbl&gt;,
## #   Neighborhood_Somerset &lt;dbl&gt;, Neighborhood_Northridge_Heights &lt;dbl&gt;,
## #   Neighborhood_Gilbert &lt;dbl&gt;, Neighborhood_Sawyer &lt;dbl&gt;,
## #   Neighborhood_other &lt;dbl&gt;, House_Style_One_Story &lt;dbl&gt;,
## #   House_Style_Two_Story &lt;dbl&gt;, House_Style_other &lt;dbl&gt;</code></pre>
<p>Note that there are fewer dummy variables for <code>Neighborhood</code> and <code>House_Style</code> than in the data.</p>
<p>Also, the above code using <code>prep</code> benefits from the default argument of <code>retain = TRUE</code>, which keeps the processed version of the data set so that we don’t have to reapply the steps to extract the processed values. For the data used to train the recipe, we would have used:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="kw">rec_training_set</span>) <span class="op">%&gt;%</span> <span class="kw">head</span>
</pre></div>
<pre><code>## # A tibble: 6 x 14
##   Year_Sold Lot_Area Sale_Price Neighborhood_Co… Neighborhood_Ol…
##       &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1      1.68    2.70        5.33           -0.317           -0.298
## 2      1.68    0.506       5.02           -0.317           -0.298
## 3      1.68    0.930       5.24           -0.317           -0.298
## 4      1.68    0.423       5.39           -0.317           -0.298
## 5      1.68    0.865       5.28           -0.317           -0.298
## 6      1.68    0.197       5.29           -0.317           -0.298
## # … with 9 more variables: Neighborhood_Edwards &lt;dbl&gt;,
## #   Neighborhood_Somerset &lt;dbl&gt;, Neighborhood_Northridge_Heights &lt;dbl&gt;,
## #   Neighborhood_Gilbert &lt;dbl&gt;, Neighborhood_Sawyer &lt;dbl&gt;,
## #   Neighborhood_other &lt;dbl&gt;, House_Style_One_Story &lt;dbl&gt;,
## #   House_Style_Two_Story &lt;dbl&gt;, House_Style_other &lt;dbl&gt;</code></pre>
<p>The next section will explore recipes and bootstrap resampling for modeling:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://rsample.tidymodels.org">rsample</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">7712</span>)
<span class="kw">bt_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bootstraps.html">bootstraps</a></span>(<span class="kw">ames</span>)
<span class="kw">bt_samples</span>
</pre></div>
<pre><code>## # Bootstrap sampling 
## # A tibble: 25 x 2
##    splits              id         
##    &lt;list&gt;              &lt;chr&gt;      
##  1 &lt;split [2.9K/1.1K]&gt; Bootstrap01
##  2 &lt;split [2.9K/1.1K]&gt; Bootstrap02
##  3 &lt;split [2.9K/1.1K]&gt; Bootstrap03
##  4 &lt;split [2.9K/1.1K]&gt; Bootstrap04
##  5 &lt;split [2.9K/1.1K]&gt; Bootstrap05
##  6 &lt;split [2.9K/1.1K]&gt; Bootstrap06
##  7 &lt;split [2.9K/1.1K]&gt; Bootstrap07
##  8 &lt;split [2.9K/1.1K]&gt; Bootstrap08
##  9 &lt;split [2.9K/1.1K]&gt; Bootstrap09
## 10 &lt;split [2.9K/1.1K]&gt; Bootstrap10
## # … with 15 more rows</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">splits</span>[[<span class="fl">1</span>]]
</pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;2930/1095/2930&gt;</code></pre>
</div>
<div id="working-with-resamples" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-resamples" class="anchor"></a>Working with Resamples</h2>
<p>We can add a recipe column to the tibble. <code>recipes</code> has a convenience function called <code>prepper</code> that can be used to call <code>prep</code> but has the split object as the first argument (for easier purrring):</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://purrr.tidyverse.org">purrr</a></span>)

<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">recipes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">splits</span>, <span class="kw">prepper</span>, recipe = <span class="kw">rec</span>)
<span class="kw">bt_samples</span>
</pre></div>
<pre><code>## # Bootstrap sampling 
## # A tibble: 25 x 3
##    splits              id          recipes 
##    &lt;list&gt;              &lt;chr&gt;       &lt;list&gt;  
##  1 &lt;split [2.9K/1.1K]&gt; Bootstrap01 &lt;recipe&gt;
##  2 &lt;split [2.9K/1.1K]&gt; Bootstrap02 &lt;recipe&gt;
##  3 &lt;split [2.9K/1.1K]&gt; Bootstrap03 &lt;recipe&gt;
##  4 &lt;split [2.9K/1.1K]&gt; Bootstrap04 &lt;recipe&gt;
##  5 &lt;split [2.9K/1.1K]&gt; Bootstrap05 &lt;recipe&gt;
##  6 &lt;split [2.9K/1.1K]&gt; Bootstrap06 &lt;recipe&gt;
##  7 &lt;split [2.9K/1.1K]&gt; Bootstrap07 &lt;recipe&gt;
##  8 &lt;split [2.9K/1.1K]&gt; Bootstrap08 &lt;recipe&gt;
##  9 &lt;split [2.9K/1.1K]&gt; Bootstrap09 &lt;recipe&gt;
## 10 &lt;split [2.9K/1.1K]&gt; Bootstrap10 &lt;recipe&gt;
## # … with 15 more rows</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">recipes</span>[[<span class="fl">1</span>]]
</pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor          4
## 
## Training data contained 2930 data points and no missing data.
## 
## Operations:
## 
## Log transformation on Sale_Price [trained]
## Collapsing factor levels for Neighborhood, House_Style [trained]
## Dummy variables from Neighborhood, House_Style [trained]
## Box-Cox transformation on Lot_Area [trained]
## Centering for Year_Sold, Lot_Area, ... [trained]
## Scaling for Year_Sold, Lot_Area, ... [trained]</code></pre>
<p>Now, to fit the model, the fit function only needs the recipe as input. This is because the above code implicitly used the <code>retain = TRUE</code> option in <code>prep</code>. Otherwise, the split objects would also be needed to <code>bake</code> the recipe (as it will in the prediction function below).</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">fit_lm</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">rec_obj</span>, <span class="kw">...</span>) 
  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw">...</span>, data = <span class="fu"><a href="https://recipes.tidymodels.org/reference/juice.html">juice</a></span>(<span class="kw">rec_obj</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span>()))

<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">lm_mod</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(
    <span class="kw">bt_samples</span><span class="op">$</span><span class="kw">recipes</span>, 
    <span class="kw">fit_lm</span>, 
    <span class="kw">Sale_Price</span> <span class="op">~</span> <span class="kw">.</span>
  )
<span class="kw">bt_samples</span>
</pre></div>
<pre><code>## # Bootstrap sampling 
## # A tibble: 25 x 4
##    splits              id          recipes  lm_mod
##    &lt;list&gt;              &lt;chr&gt;       &lt;list&gt;   &lt;list&gt;
##  1 &lt;split [2.9K/1.1K]&gt; Bootstrap01 &lt;recipe&gt; &lt;lm&gt;  
##  2 &lt;split [2.9K/1.1K]&gt; Bootstrap02 &lt;recipe&gt; &lt;lm&gt;  
##  3 &lt;split [2.9K/1.1K]&gt; Bootstrap03 &lt;recipe&gt; &lt;lm&gt;  
##  4 &lt;split [2.9K/1.1K]&gt; Bootstrap04 &lt;recipe&gt; &lt;lm&gt;  
##  5 &lt;split [2.9K/1.1K]&gt; Bootstrap05 &lt;recipe&gt; &lt;lm&gt;  
##  6 &lt;split [2.9K/1.1K]&gt; Bootstrap06 &lt;recipe&gt; &lt;lm&gt;  
##  7 &lt;split [2.9K/1.1K]&gt; Bootstrap07 &lt;recipe&gt; &lt;lm&gt;  
##  8 &lt;split [2.9K/1.1K]&gt; Bootstrap08 &lt;recipe&gt; &lt;lm&gt;  
##  9 &lt;split [2.9K/1.1K]&gt; Bootstrap09 &lt;recipe&gt; &lt;lm&gt;  
## 10 &lt;split [2.9K/1.1K]&gt; Bootstrap10 &lt;recipe&gt; &lt;lm&gt;  
## # … with 15 more rows</code></pre>
<p>To get predictions, the function needs three arguments: the splits (to get the assessment data), the recipe (to process them), and the model. To iterate over these, the function <code><a href="https://purrr.tidyverse.org/reference/map2.html">purrr::pmap</a></code> is used:</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="kw">pred_lm</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">split_obj</span>, <span class="kw">rec_obj</span>, <span class="kw">model_obj</span>, <span class="kw">...</span>) {
  <span class="kw">mod_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html">bake</a></span>(
    <span class="kw">rec_obj</span>, 
    new_data = <span class="fu"><a href="../../reference/as.data.frame.rsplit.html">assessment</a></span>(<span class="kw">split_obj</span>),
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span>(),
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_outcomes</a></span>()
  ) 
  
  <span class="kw">out</span> <span class="op">&lt;-</span> <span class="kw">mod_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">Sale_Price</span>)
  <span class="kw">out</span><span class="op">$</span><span class="kw">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">model_obj</span>, newdata = <span class="kw">mod_data</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span><span class="kw">Sale_Price</span>))
  <span class="kw">out</span>
}

<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">pred</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">pmap</a></span>(
    <span class="fu"><a href="https://tibble.tidyverse.org/reference/lst.html">lst</a></span>(
      split_obj = <span class="kw">bt_samples</span><span class="op">$</span><span class="kw">splits</span>, 
      rec_obj = <span class="kw">bt_samples</span><span class="op">$</span><span class="kw">recipes</span>, 
      model_obj = <span class="kw">bt_samples</span><span class="op">$</span><span class="kw">lm_mod</span>
    ),
    <span class="kw">pred_lm</span> 
  )
<span class="kw">bt_samples</span>
</pre></div>
<pre><code>## # Bootstrap sampling 
## # A tibble: 25 x 5
##    splits              id          recipes  lm_mod pred                
##    &lt;list&gt;              &lt;chr&gt;       &lt;list&gt;   &lt;list&gt; &lt;list&gt;              
##  1 &lt;split [2.9K/1.1K]&gt; Bootstrap01 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,095 × 2]&gt;
##  2 &lt;split [2.9K/1.1K]&gt; Bootstrap02 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,082 × 2]&gt;
##  3 &lt;split [2.9K/1.1K]&gt; Bootstrap03 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,072 × 2]&gt;
##  4 &lt;split [2.9K/1.1K]&gt; Bootstrap04 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,077 × 2]&gt;
##  5 &lt;split [2.9K/1.1K]&gt; Bootstrap05 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,074 × 2]&gt;
##  6 &lt;split [2.9K/1.1K]&gt; Bootstrap06 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,088 × 2]&gt;
##  7 &lt;split [2.9K/1.1K]&gt; Bootstrap07 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,076 × 2]&gt;
##  8 &lt;split [2.9K/1.1K]&gt; Bootstrap08 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,068 × 2]&gt;
##  9 &lt;split [2.9K/1.1K]&gt; Bootstrap09 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,062 × 2]&gt;
## 10 &lt;split [2.9K/1.1K]&gt; Bootstrap10 &lt;recipe&gt; &lt;lm&gt;   &lt;tibble [1,064 × 2]&gt;
## # … with 15 more rows</code></pre>
<p>Calculating the RMSE:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/tidymodels/yardstick">yardstick</a></span>)
</pre></div>
<pre><code>## For binary classification, the first factor level is assumed to be the event.
## Use the argument `event_level = "second"` to alter this as needed.</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="kw">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="kw">bt_samples</span><span class="op">$</span><span class="kw">pred</span>, <span class="kw">rmse</span>, <span class="kw">Sale_Price</span>, <span class="kw">predicted</span>)
<span class="kw">results</span>
</pre></div>
<pre><code>## # A tibble: 25 x 3
##    .metric .estimator .estimate
##    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
##  1 rmse    standard       0.132
##  2 rmse    standard       0.128
##  3 rmse    standard       0.129
##  4 rmse    standard       0.123
##  5 rmse    standard       0.125
##  6 rmse    standard       0.140
##  7 rmse    standard       0.129
##  8 rmse    standard       0.130
##  9 rmse    standard       0.122
## 10 rmse    standard       0.127
## # … with 15 more rows</code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">results</span><span class="op">$</span><span class="kw">.estimate</span>)
</pre></div>
<pre><code>## [1] 0.129</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>rsample is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn, Fanny Chow, <a href="http://hadley.nz">Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
