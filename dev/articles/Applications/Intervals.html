<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bootstrap confidence intervals • rsample</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Bootstrap confidence intervals">
<meta name="robots" content="noindex">
<script defer data-domain="rsample.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">rsample</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/rsample.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/Common_Patterns.html">Common Resampling Patterns</a></li>
    <li><a class="dropdown-item" href="../../articles/Applications/Intervals.html">Bootstrap confidence intervals</a></li>
    <li><a class="dropdown-item" href="../../articles/Applications/Recipes_and_rsample.html">Recipes with rsample</a></li>
    <li><a class="dropdown-item" href="../../articles/Working_with_rsets.html">Working with resampling sets</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more">
<li><a class="external-link dropdown-item" href="https://spatialsample.tidymodels.org/">Spatial resampling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/nested-resampling/">Nested resampling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/models/time-series/">Time series analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/rsample/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Bootstrap confidence intervals</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/rsample/blob/main/vignettes/Applications/Intervals.Rmd" class="external-link"><code>vignettes/Applications/Intervals.Rmd</code></a></small>
      <div class="d-none name"><code>Intervals.Rmd</code></div>
    </div>

    
    
<p>The bootstrap was originally intended for estimating confidence
intervals for complex statistics whose variance properties are difficult
to analytically derive. Davison and Hinkley’s <a href="https://www.cambridge.org/core/books/bootstrap-methods-and-their-application/ED2FD043579F27952363566DC09CBD6A" class="external-link"><em>Bootstrap
Methods and Their Application</em></a> is a great resource for these
methods. rsample contains a few functions to compute the most common
types of intervals.</p>
<div class="section level2">
<h2 id="a-nonlinear-regression-example">A nonlinear regression example<a class="anchor" aria-label="anchor" href="#a-nonlinear-regression-example"></a>
</h2>
<p>To demonstrate the computations for the different types of intervals,
we’ll use a nonlinear regression example from <a href="https://www.jstatsoft.org/article/view/v066i05" class="external-link">Baty <em>et
al</em> (2015)</a>. They showed data that monitored oxygen uptake in a
patient with rest and exercise phases (in the data frame
<code>O2K</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lbbe-software/nlstools" class="external-link">nlstools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggobi.github.io/ggally/" class="external-link">GGally</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">O2K</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">O2K</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">VO2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Intervals_files/figure-html/O2K-dat-1.png" alt="A scatterplot with time on the x-axis and oxygen uptake on the y-axis. For time &lt; 6, the oxygen uptake remains at around 400. Between time = 6 and time = 9, it rises to about 1600, then remains around that value." width="768"></p>
<p>The authors fit a segmented regression model where the transition
point was known (this is the time when exercise commenced). Their model
was:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonlin_form</span> <span class="op">&lt;-</span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span></span>
<span>    <span class="va">VO2</span> <span class="op">~</span> <span class="op">(</span><span class="va">t</span> <span class="op">&lt;=</span> <span class="fl">5.883</span><span class="op">)</span> <span class="op">*</span> <span class="va">VO2rest</span> <span class="op">+</span> </span>
<span>      <span class="op">(</span><span class="va">t</span> <span class="op">&gt;</span> <span class="fl">5.883</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="op">(</span><span class="va">VO2rest</span> <span class="op">+</span> <span class="op">(</span><span class="va">VO2peak</span> <span class="op">-</span> <span class="va">VO2rest</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="fl">5.883</span><span class="op">)</span> <span class="op">/</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Starting values from visual inspection</span></span>
<span><span class="va">start_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>VO2rest <span class="op">=</span> <span class="fl">400</span>, VO2peak <span class="op">=</span> <span class="fl">1600</span>, mu <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a></span><span class="op">(</span><span class="va">nonlin_form</span>, start <span class="op">=</span> <span class="va">start_vals</span>, data <span class="op">=</span> <span class="va">O2K</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   term    estimate std.error statistic  p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2rest   357.     11.4         31.3 4.27<span style="color: #949494;">e</span><span style="color: #BB0000;">-26</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2peak  <span style="text-decoration: underline;">1</span>631.     21.5         75.9 1.29<span style="color: #949494;">e</span><span style="color: #BB0000;">-38</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mu          1.19    0.076<span style="text-decoration: underline;">6</span>      15.5 1.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-16</span></span></span></code></pre>
<p><code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">broom::tidy()</a></code> returns our analysis object in a
standardized way. The column names shown here are used for most types of
objects and this allows us to use the results more easily.</p>
<p>For rsample, we’ll rely on the <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> method to work
with bootstrap estimates when we need confidence intervals. There’s an
example at the end of a univariate statistic that isn’t automatically
formatted with <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>.</p>
<p>To run our model over different bootstraps, we’ll write a function
that uses the <code>split</code> object as input and produces a tidy
data frame:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Will be used to fit the models to different bootstrap data sets:</span></span>
<span><span class="va">fit_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">split</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># We could check for convergence, make new parameters, etc.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a></span><span class="op">(</span><span class="va">nonlin_form</span>, data <span class="op">=</span> <span class="fu"><a href="../../reference/as.data.frame.rsplit.html">analysis</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>First, let’s create a set of resamples and fit separate models to
each. The options <code>apparent = TRUE</code> will be set. This creates
a final resample that is a copy of the original (unsampled) data set.
This is required for some of the interval methods.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">462</span><span class="op">)</span></span>
<span><span class="va">nlin_bt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../../reference/bootstraps.html">bootstraps</a></span><span class="op">(</span><span class="va">O2K</span>, times <span class="op">=</span> <span class="fl">2000</span>, apparent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>models <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">splits</span>, \<span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="fu">fit_fun</span><span class="op">(</span><span class="va">.x</span>, start <span class="op">=</span> <span class="va">start_vals</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nlin_bt</span></span></code></pre></div>
<pre><code><span><span class="co">## # Bootstrap sampling with apparent sample </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2,001 × 3</span></span></span>
<span><span class="co">##    splits          id            models          </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> <span style="color: #949494;">&lt;split [36/14]&gt;</span> Bootstrap0001 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> <span style="color: #949494;">&lt;split [36/13]&gt;</span> Bootstrap0002 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> <span style="color: #949494;">&lt;split [36/16]&gt;</span> Bootstrap0003 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> <span style="color: #949494;">&lt;split [36/12]&gt;</span> Bootstrap0004 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> <span style="color: #949494;">&lt;split [36/16]&gt;</span> Bootstrap0005 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> <span style="color: #949494;">&lt;split [36/13]&gt;</span> Bootstrap0006 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> <span style="color: #949494;">&lt;split [36/15]&gt;</span> Bootstrap0007 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> <span style="color: #949494;">&lt;split [36/16]&gt;</span> Bootstrap0008 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> <span style="color: #949494;">&lt;split [36/11]&gt;</span> Bootstrap0009 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> <span style="color: #949494;">&lt;split [36/13]&gt;</span> Bootstrap0010 <span style="color: #949494;">&lt;tibble [3 × 5]&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,991 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nlin_bt</span><span class="op">$</span><span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   term    estimate std.error statistic  p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2rest   359.      10.7        33.5 4.59<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2peak  <span style="text-decoration: underline;">1</span>656.      31.1        53.3 1.39<span style="color: #949494;">e</span><span style="color: #BB0000;">-33</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mu          1.23     0.113      10.9 2.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span></span></span></code></pre>
<p>Let’s look at the data and see if there any outliers or aberrant
results:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">nls_coef</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">nlin_bt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">splits</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Turn it into a tibble by stacking the `models` col</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">models</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Get rid of unneeded columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">term</span>, <span class="va">estimate</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nls_coef</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">##   id            term    estimate</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Bootstrap0001 VO2rest   359.  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Bootstrap0001 VO2peak  <span style="text-decoration: underline;">1</span>656.  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Bootstrap0001 mu          1.23</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Bootstrap0002 VO2rest   358.  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Bootstrap0002 VO2peak  <span style="text-decoration: underline;">1</span>662.  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Bootstrap0002 mu          1.26</span></span></code></pre>
<p>Now let’s create a scatterplot matrix:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nls_coef</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Put different parameters in columns</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">term</span>, values_from <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Keep only numeric columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggscatmat.html" class="external-link">ggscatmat</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span></span></code></pre></div>
<p><img src="Intervals_files/figure-html/splom-1.png" alt="The 3x3 scatter plot matrix for the variables VO2rest, VO2peak, and mu. We can see one value for VO2peak that is larger than the rest." width="768"></p>
<p>One potential outlier on the right for <code>VO2peak</code> but we’ll
leave it in.</p>
<p>The univariate distributions are:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nls_coef</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Intervals_files/figure-html/hists-1.png" alt="Three histograms for mu, VO2peak, and VO2rest: all distributions are unimodal and symmetric." width="768"></p>
<div class="section level3">
<h3 id="percentile-intervals">Percentile intervals<a class="anchor" aria-label="anchor" href="#percentile-intervals"></a>
</h3>
<p>The most basic type of interval uses <em>percentiles</em> of the
resampling distribution. To get the percentile intervals, the
<code>rset</code> object is passed as the first argument and the second
argument is the list column of tidy results:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/int_pctl.html">int_pctl</a></span><span class="op">(</span><span class="va">nlin_bt</span>, <span class="va">models</span><span class="op">)</span></span>
<span><span class="va">p_ints</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   term     .lower .estimate  .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2peak <span style="text-decoration: underline;">1</span>576.     <span style="text-decoration: underline;">1</span>632.   <span style="text-decoration: underline;">1</span>694.     0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2rest  344.      357.    370.     0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mu         1.00      1.18    1.35   0.05 percentile</span></span></code></pre>
<p>When overlaid with the univariate distributions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nls_coef</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p_ints</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">.lower</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p_ints</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Intervals_files/figure-html/pctl-plot-1.png" alt="The three histograms for mu, VO2peak, and VO2rest with added vertical lines for the estimated lower and upper bounds of the percentile intervals." width="768"></p>
<p>How do these intervals compare to the parametric asymptotic
values?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parametric</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">res</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">term</span>,</span>
<span>    .lower <span class="op">=</span> <span class="va">conf.low</span>,</span>
<span>    .estimate <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    .upper <span class="op">=</span> <span class="va">conf.high</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    .alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    .method <span class="op">=</span> <span class="st">"parametric"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">intervals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">parametric</span>, <span class="va">p_ints</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">.method</span><span class="op">)</span></span>
<span><span class="va">intervals</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">$</span><span class="va">term</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $mu</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   term  .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> mu      1.05      1.19   1.34   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mu      1.00      1.18   1.35   0.05 percentile</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2peak</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2peak  <span style="text-decoration: underline;">1</span>590.     <span style="text-decoration: underline;">1</span>631.  <span style="text-decoration: underline;">1</span>675.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2peak  <span style="text-decoration: underline;">1</span>576.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>694.   0.05 percentile</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2rest</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2rest   334.      357.   380.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2rest   344.      357.   370.   0.05 percentile</span></span></code></pre>
<p>The percentile intervals are wider than the parametric intervals
(which assume asymptotic normality). Do the estimates appear to be
normally distributed? We can look at quantile-quantile plots:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nls_coef</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Intervals_files/figure-html/qqplot-1.png" alt="Three QQ plots for mu, VO2peak, and VO2rest which show that the empirical distributions deviate from a normal distribution in the tails." width="768"></p>
</div>
<div class="section level3">
<h3 id="t-intervals">t-intervals<a class="anchor" aria-label="anchor" href="#t-intervals"></a>
</h3>
<p>Bootstrap <em>t</em>-intervals are estimated by computing
intermediate statistics that are <em>t</em>-like in structure. To use
these, we require the estimated variance <em>for each individual
resampled estimate</em>. In our example, this comes along with the
fitted model object. We can extract the standard errors of the
parameters. Luckily, most <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> methods provide this in a
column named <code>std.error</code>.</p>
<p>The arguments for these intervals are the same:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/int_pctl.html">int_t</a></span><span class="op">(</span><span class="va">nlin_bt</span>, <span class="va">models</span><span class="op">)</span></span>
<span><span class="va">intervals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">intervals</span>, <span class="va">t_stats</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">.method</span><span class="op">)</span></span>
<span><span class="va">intervals</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">$</span><span class="va">term</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $mu</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   term  .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> mu     1.05       1.19   1.34   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mu     1.00       1.18   1.35   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mu     1.000      1.18   1.35   0.05 student-t </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2peak</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2peak  <span style="text-decoration: underline;">1</span>590.     <span style="text-decoration: underline;">1</span>631.  <span style="text-decoration: underline;">1</span>675.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2peak  <span style="text-decoration: underline;">1</span>576.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>694.   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> VO2peak  <span style="text-decoration: underline;">1</span>568.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>691.   0.05 student-t </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2rest</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2rest   334.      357.   380.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2rest   344.      357.   370.   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> VO2rest   342.      357.   370.   0.05 student-t</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="bias-corrected-and-accelerated-intervals">Bias-corrected and accelerated intervals<a class="anchor" aria-label="anchor" href="#bias-corrected-and-accelerated-intervals"></a>
</h3>
<p>For bias-corrected and accelerated (BCa) intervals, an additional
argument is required. The <code>.fn</code> argument is a function that
computes the statistic of interest. The first argument should be for the
<code>rsplit</code> object and other arguments can be passed in using
the ellipses.</p>
<p>These intervals use an internal leave-one-out resample to compute the
Jackknife statistic and will recompute the statistic for <em>every
bootstrap resample</em>. If the statistic is expensive to compute, this
may take some time. For those calculations, we use the furrr package so
these can be computed in parallel if you have set up a parallel
processing plan (see <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">?future::plan</a></code>).</p>
<p>The user-facing function takes an argument for the function and the
ellipses.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bias_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/int_pctl.html">int_bca</a></span><span class="op">(</span><span class="va">nlin_bt</span>, <span class="va">models</span>, .fn <span class="op">=</span> <span class="va">fit_fun</span>, start <span class="op">=</span> <span class="va">start_vals</span><span class="op">)</span></span>
<span><span class="va">intervals</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">intervals</span>, <span class="va">bias_corr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">.method</span><span class="op">)</span></span>
<span><span class="va">intervals</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">intervals</span><span class="op">$</span><span class="va">term</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $mu</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">##   term  .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> mu     0.996      1.18   1.34   0.05 BCa       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> mu     1.05       1.19   1.34   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> mu     1.00       1.18   1.35   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> mu     1.000      1.18   1.35   0.05 student-t </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2peak</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2peak  <span style="text-decoration: underline;">1</span>561.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>680.   0.05 BCa       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2peak  <span style="text-decoration: underline;">1</span>590.     <span style="text-decoration: underline;">1</span>631.  <span style="text-decoration: underline;">1</span>675.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> VO2peak  <span style="text-decoration: underline;">1</span>576.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>694.   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> VO2peak  <span style="text-decoration: underline;">1</span>568.     <span style="text-decoration: underline;">1</span>632.  <span style="text-decoration: underline;">1</span>691.   0.05 student-t </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $VO2rest</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> VO2rest   343.      357.   368.   0.05 BCa       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> VO2rest   334.      357.   380.   0.05 parametric</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> VO2rest   344.      357.   370.   0.05 percentile</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> VO2rest   342.      357.   370.   0.05 student-t</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="no-existing-tidy-method">No existing tidy method<a class="anchor" aria-label="anchor" href="#no-existing-tidy-method"></a>
</h2>
<p>In this case, your function can emulate the minimum results:</p>
<ul>
<li>a character column called <code>term</code>,</li>
<li>a numeric column called <code>estimate</code>, and, optionally,</li>
<li>a numeric column called <code>std.error</code>.</li>
</ul>
<p>The last column is only needed for <code><a href="../../reference/int_pctl.html">int_t()</a></code>.</p>
<p>Suppose we just want to estimate the fold-increase in the outcome
between the 90th and 10th percentiles over the course of the experiment.
Our function might look like:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fold_incr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">split</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/as.data.frame.rsplit.html">analysis</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span>  <span class="va">quants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">VO2</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    term <span class="op">=</span> <span class="st">"fold increase"</span>,</span>
<span>    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">quants</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">quants</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    <span class="co"># We don't know the analytical formula for this </span></span>
<span>    std.error <span class="op">=</span> <span class="cn">NA_real_</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Everything else works the same as before:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nlin_bt</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">nlin_bt</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>folds <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">splits</span>, <span class="va">fold_incr</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../../reference/int_pctl.html">int_pctl</a></span><span class="op">(</span><span class="va">nlin_bt</span>, <span class="va">folds</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">##   term          .lower .estimate .upper .alpha .method   </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> fold increase   4.42      4.76   5.05   0.05 percentile</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/int_pctl.html">int_bca</a></span><span class="op">(</span><span class="va">nlin_bt</span>, <span class="va">folds</span>, .fn <span class="op">=</span> <span class="va">fold_incr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 6</span></span></span>
<span><span class="co">##   term          .lower .estimate .upper .alpha .method</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> fold increase   4.53      4.76   5.36   0.05 BCa</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="intervals-for-linearish-parametric-intervals">Intervals for linear(ish) parametric intervals<a class="anchor" aria-label="anchor" href="#intervals-for-linearish-parametric-intervals"></a>
</h2>
<p>rsample also contains the <code><a href="../../reference/reg_intervals.html">reg_intervals()</a></code> function that
can be used for linear regression (via <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>), generalized
linear models (<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>), or log-linear survival models
(<code><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survival::survreg()</a></code> or <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">survival::coxph()</a></code>).
This function makes it easier to get intervals for these models.</p>
<p>A simple example is a logistic regression using the dementia data
from the <code>modeldata</code> package:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ad_data</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s fit a model with a few predictors:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lr_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">male</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">Ab_42</span> <span class="op">+</span> <span class="va">tau</span>, data <span class="op">=</span> <span class="va">ad_data</span>,</span>
<span>              family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html" class="external-link">glance</a></span><span class="op">(</span><span class="va">lr_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 8</span></span></span>
<span><span class="co">##   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs</span></span>
<span><span class="co">##           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>          391.     332  -<span style="color: #BB0000;">140.</span>  289.  308.     279.         328   333</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">lr_mod</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">##   term        estimate std.error statistic       p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)  129.      112.         1.15 0.250        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> male          -<span style="color: #BB0000;">0.744</span>     0.307     -<span style="color: #BB0000;">2.43</span> 0.015<span style="text-decoration: underline;">2</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> age         -<span style="color: #BB0000;">125.</span>      114.        -<span style="color: #BB0000;">1.10</span> 0.272        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Ab_42          0.534     0.104      5.14 0.000<span style="text-decoration: underline;">000</span>282  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> tau           -<span style="color: #BB0000;">1.78</span>      0.309     -<span style="color: #BB0000;">5.77</span> 0.000<span style="text-decoration: underline;">000</span>008<span style="text-decoration: underline;">07</span></span></span></code></pre>
<p>Let’s use this model with student-t intervals:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">29832</span><span class="op">)</span></span>
<span><span class="va">lr_int</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../../reference/reg_intervals.html">reg_intervals</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">male</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">Ab_42</span> <span class="op">+</span> <span class="va">tau</span>, </span>
<span>                data <span class="op">=</span> <span class="va">ad_data</span>,</span>
<span>                model_fn <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>                family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">lr_int</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method  </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Ab_42    0.316     0.548  0.765   0.05 student-t</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> age   -<span style="color: #BB0000;">332.</span>     -<span style="color: #BB0000;">133.</span>    85.7     0.05 student-t</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> male    -<span style="color: #BB0000;">1.35</span>     -<span style="color: #BB0000;">0.755</span> -<span style="color: #BB0000;">0.133</span>   0.05 student-t</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> tau     -<span style="color: #BB0000;">2.38</span>     -<span style="color: #BB0000;">1.83</span>  -<span style="color: #BB0000;">1.17</span>    0.05 student-t</span></span></code></pre>
<p>We can also save the resamples for plotting:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">29832</span><span class="op">)</span></span>
<span><span class="va">lr_int</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../../reference/reg_intervals.html">reg_intervals</a></span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">male</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">Ab_42</span> <span class="op">+</span> <span class="va">tau</span>, </span>
<span>                data <span class="op">=</span> <span class="va">ad_data</span>,</span>
<span>                keep_reps <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                model_fn <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>                family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span><span class="va">lr_int</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">##   term    .lower .estimate .upper .alpha .method          .replicates</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&lt;tibble[,2]&gt;&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Ab_42    0.316     0.548  0.765   0.05 student-t        <span style="color: #949494;">[1,001 × 2]</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> age   -<span style="color: #BB0000;">332.</span>     -<span style="color: #BB0000;">133.</span>    85.7     0.05 student-t        <span style="color: #949494;">[1,001 × 2]</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> male    -<span style="color: #BB0000;">1.35</span>     -<span style="color: #BB0000;">0.755</span> -<span style="color: #BB0000;">0.133</span>   0.05 student-t        <span style="color: #949494;">[1,001 × 2]</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> tau     -<span style="color: #BB0000;">2.38</span>     -<span style="color: #BB0000;">1.83</span>  -<span style="color: #BB0000;">1.17</span>    0.05 student-t        <span style="color: #949494;">[1,001 × 2]</span></span></span></code></pre>
<p>Now we can unnest the data to use in a ggplot:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lr_int</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">.replicates</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">.replicates</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">term</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lr_int</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">.lower</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lr_int</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Intervals_files/figure-html/ad-plot-1.png" alt="Four histograms for the distribution of the regression model coefficients, with vertical lines indicating the estimated lower and upper interval bounds, as well as vertical lines for a coefficient value of 0. For age, the interval encloses 0, for the other variables it does not." width="768"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frick.ws" class="external-link">Hannah Frick</a>, Fanny Chow, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Michael Mahoney, <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
