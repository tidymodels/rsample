<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create or Modify Stratification Variables — make_strata • rsample</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create or Modify Stratification Variables — make_strata"><meta name="description" content="This function can create strata from numeric data and make non-numeric data
more conducive for stratification."><meta property="og:description" content="This function can create strata from numeric data and make non-numeric data
more conducive for stratification."><meta property="og:image" content="https://rsample.tidymodels.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="rsample.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rsample</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rsample.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Common_Patterns.html">Common Resampling Patterns</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/Intervals.html">Bootstrap confidence intervals</a></li>
    <li><a class="dropdown-item" href="../articles/Applications/Recipes_and_rsample.html">Recipes with rsample</a></li>
    <li><a class="dropdown-item" href="../articles/Working_with_rsets.html">Working with resampling sets</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-learn-more" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Learn more</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-learn-more"><li><a class="external-link dropdown-item" href="https://spatialsample.tidymodels.org/">Spatial resampling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/work/nested-resampling/">Nested resampling</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidymodels.org/learn/models/time-series/">Time series analysis</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/rsample/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create or Modify Stratification Variables</h1>
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/rsample/blob/main/R/make_strata.R" class="external-link"><code>R/make_strata.R</code></a></small>
      <div class="d-none name"><code>make_strata.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function can create strata from numeric data and make non-numeric data
more conducive for stratification.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fl">4</span>, nunique <span class="op">=</span> <span class="fl">5</span>, pool <span class="op">=</span> <span class="fl">0.1</span>, depth <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>An input vector.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>A single number giving the number of bins desired to stratify a
numeric stratification variable.</p></dd>


<dt id="arg-nunique">nunique<a class="anchor" aria-label="anchor" href="#arg-nunique"></a></dt>
<dd><p>An integer for the number of unique value threshold in the
algorithm.</p></dd>


<dt id="arg-pool">pool<a class="anchor" aria-label="anchor" href="#arg-pool"></a></dt>
<dd><p>A proportion of data used to determine if a particular group is
too small and should be pooled into another group. We do not recommend
decreasing this argument below its default of 0.1 because of the dangers
of stratifying groups that are too small.</p></dd>


<dt id="arg-depth">depth<a class="anchor" aria-label="anchor" href="#arg-depth"></a></dt>
<dd><p>An integer that is used to determine the best number of
percentiles that should be used. The number of bins are based on
<code>min(5, floor(n / depth))</code> where <code>n = length(x)</code>.
If <code>x</code> is numeric, there must be at least 40 rows in the data set
(when <code>depth = 20</code>) to conduct stratified sampling.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A factor vector.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For numeric data, if the number of unique levels is less than
<code>nunique</code>, the data are treated as categorical data.</p>
<p>For categorical inputs, the function will find levels of <code>x</code> than
occur in the data with percentage less than <code>pool</code>. The values from
these groups will be randomly assigned to the remaining strata (as will
data points that have missing values in <code>x</code>).</p>
<p>For numeric data with more unique values than <code>nunique</code>, the data
will be converted to being categorical based on percentiles of the data.
The percentile groups will have no more than 20 percent of the data in
each group. Again, missing values in <code>x</code> are randomly assigned
to groups.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">61</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, lambda <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1  2  3  4  5  6  7  8  9 10 11 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3 16  8 19 14 18 11  4  5  1  1 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,3]  (3,5]  (5,6] (6,11] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     27     33     18     22 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">554</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0  1  2  3  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36 34 19  6  5 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0  1  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38 40 22 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># small groups are randomly assigned</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0  1  2  3  4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 36 34 19  6  5 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0  1  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 41 35 24 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">37</span>, <span class="fl">26</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">11</span>, <span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A  B  C  D  E  F  G </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37 26  3  7 11 10  2 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A  B  E  F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 40 27 14 15 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x4</span>, pool <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A  B  E  F </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 38 29 12 17 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x4</span>, pool <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Stratifying groups that make up 0% of the data may be statistically</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> risky.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Consider increasing `pool` to at least 0.1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  A  B  C  D  E  F  G </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37 26  3  7 11 10  2 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># not enough data to stratify</span></span></span>
<span class="r-in"><span><span class="va">x5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The number of observations in each quantile is below the recommended</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> threshold of 20.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Stratification will use 1 breaks instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Too little data to stratify.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">•</span> Resampling will be unstratified.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> strata1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      20 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">483</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x6</span>, probs <span class="op">=</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0%        10%        20%        30%        40%        50% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.9114060 -1.4508635 -0.9513821 -0.6257852 -0.3286468 -0.0364388 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        60%        70%        80%        90%       100% </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.2027140  0.4278573  0.7050643  1.2471852  2.6792505 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu">make_strata</span><span class="op">(</span><span class="va">x6</span>, breaks <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [-2.91,-1.45]   (-1.45,-0.951]  (-0.951,-0.626]  (-0.626,-0.329] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               20               20               20               20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (-0.329,-0.0364]  (-0.0364,0.203]    (0.203,0.428]    (0.428,0.705] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               20               20               20               20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     (0.705,1.25]      (1.25,2.68] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               20               20 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://frick.ws" class="external-link">Hannah Frick</a>, Fanny Chow, <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, Michael Mahoney, <a href="https://juliasilge.com/" class="external-link">Julia Silge</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

