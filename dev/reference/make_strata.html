<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create or Modify Stratification Variables — make_strata • rsample</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../tidymodels.css" rel="stylesheet">




<meta property="og:title" content="Create or Modify Stratification Variables — make_strata" />
<meta property="og:description" content="For stratified resampling, this function can create strata from numeric data
and also make non-numeric data more conducive to be used for
stratification." />
<meta property="og:image" content="https://rsample.tidymodels.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">rsample</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.0.9.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/rsample.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Working_with_rsets.html">Working with Resample Sets</a>
    </li>
    <li>
      <a href="../articles/Applications/Recipes_and_rsample.html">Recipes and rsample</a>
    </li>
    <li>
      <a href="../articles/Applications/Survival_Analysis.html">Survival Analysis</a>
    </li>
    <li>
      <a href="../articles/Applications/Intervals.html">Bootstrap Interval Estimation</a>
    </li>
    <li>
      <a href="https://www.tidymodels.org/learn/models/time-series/">Time Series Analysis</a>
    </li>
    <li>
      <a href="https://www.tidymodels.org/learn/work/nested-resampling/">Nested Resampling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/rsample/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create or Modify Stratification Variables</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidymodels/rsample/blob/master/R/make_strata.R'><code>R/make_strata.R</code></a></small>
    <div class="hidden name"><code>make_strata.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For stratified resampling, this function can create strata from numeric data
and also make non-numeric data more conducive to be used for
stratification.</p>
    </div>

    <pre class="usage"><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x</span>, breaks <span class='op'>=</span> <span class='fl'>4</span>, nunique <span class='op'>=</span> <span class='fl'>5</span>, pool <span class='op'>=</span> <span class='fl'>0.1</span>, depth <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>An input vector.</p></td>
    </tr>
    <tr>
      <th>breaks</th>
      <td><p>A single number giving the number of bins desired to stratify a
numeric stratification variable.</p></td>
    </tr>
    <tr>
      <th>nunique</th>
      <td><p>An integer for the number of unique value threshold in the
algorithm.</p></td>
    </tr>
    <tr>
      <th>pool</th>
      <td><p>A proportion of data used to determine if a particular group is
too small and should be pooled into another group. We do not recommend
decreasing this argument below its default of 0.1 because of the dangers
of stratifying groups that are too small.</p></td>
    </tr>
    <tr>
      <th>depth</th>
      <td><p>An integer that is used to determine the best number of
percentiles that should be used. The number of bins are based on
<code><a href='https://rdrr.io/r/base/Extremes.html'>min(5, floor(n / depth))</a></code> where <code>n = length(x)</code>.
If <code>x</code> is numeric, there must be at least 40 rows in the data set
(when <code>depth = 20</code>) to conduct stratified sampling.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A factor vector.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For numeric data, if the number of unique levels is less than
<code>nunique</code>, the data are treated as categorical data.</p>
<p>For categorical inputs, the function will find levels of <code>x</code> than
occur in the data with percentage less than <code>pool</code>. The values from
these groups will be randomly assigned to the remaining strata (as will
data points that have missing values in <code>x</code>).</p>
<p>For numeric data with more unique values than <code>nunique</code>, the data
will be converted to being categorical based on percentiles of the data.
The percentile groups will have no more than 20 percent of the data in
each group. Again, missing values in <code>x</code> are randomly assigned
to groups.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>61</span><span class='op'>)</span>
<span class='va'>x1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='fl'>100</span>, lambda <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>x1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; x1
#&gt;  1  2  3  4  5  6  7  8  9 10 11 
#&gt;  3 16  8 19 14 18 11  4  5  1  1 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;  [1,3]  (3,5]  (5,6] (6,11] 
#&gt;     27     33     18     22 </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>554</span><span class='op'>)</span>
<span class='va'>x2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Poisson.html'>rpois</a></span><span class='op'>(</span><span class='fl'>100</span>, lambda <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>x2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; x2
#&gt;  0  1  2  3  4 
#&gt; 36 34 19  6  5 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;  0  1  2 
#&gt; 38 40 22 </div><div class='input'>
<span class='co'># small groups are randomly assigned</span>
<span class='va'>x3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>x2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>x3</span><span class='op'>)</span>
</div><div class='output co'>#&gt; x3
#&gt;  0  1  2  3  4 
#&gt; 36 34 19  6  5 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x3</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;  0  1  2 
#&gt; 41 35 24 </div><div class='input'>
<span class='co'># `oilType` data from `caret`</span>
<span class='va'>x4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='va'>LETTERS</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>7</span><span class='op'>]</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>37</span>, <span class='fl'>26</span>, <span class='fl'>3</span>, <span class='fl'>7</span>, <span class='fl'>11</span>, <span class='fl'>10</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>x4</span><span class='op'>)</span>
</div><div class='output co'>#&gt; x4
#&gt;  A  B  C  D  E  F  G 
#&gt; 37 26  3  7 11 10  2 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x4</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;  A  B  E  F 
#&gt; 40 27 14 15 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x4</span>, pool <span class='op'>=</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;  A  B  E  F 
#&gt; 38 29 12 17 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x4</span>, pool <span class='op'>=</span> <span class='fl'>0.0</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: Stratifying groups that make up 0% of the data may be statistically risky.</span>
#&gt; <span class='warning'>Consider increasing `pool` to at least 0.1</span></div><div class='output co'>#&gt; 
#&gt;  A  B  C  D  E  F  G 
#&gt; 37 26  3  7 11 10  2 </div><div class='input'>
<span class='co'># not enough data to stratify</span>
<span class='va'>x5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>20</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x5</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: The number of observations in each quantile is below the recommended threshold of 20. Stratification will be done with 1 breaks instead.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Too little data to stratify. Unstratified resampling </span></div><div class='output co'>#&gt; 
#&gt; strata1 
#&gt;      20 </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>483</span><span class='op'>)</span>
<span class='va'>x6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fl'>200</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>x6</span>, probs <span class='op'>=</span> <span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>10</span><span class='op'>)</span>
</div><div class='output co'>#&gt;         0%        10%        20%        30%        40%        50%        60% 
#&gt; -2.9114060 -1.4508635 -0.9513821 -0.6257852 -0.3286468 -0.0364388  0.2027140 
#&gt;        70%        80%        90%       100% 
#&gt;  0.4278573  0.7050643  1.2471852  2.6792505 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'>make_strata</span><span class='op'>(</span><span class='va'>x6</span>, breaks <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 
#&gt;    [-2.91,-1.45]   (-1.45,-0.951]  (-0.951,-0.626]  (-0.626,-0.329] 
#&gt;               20               20               20               20 
#&gt; (-0.329,-0.0364]  (-0.0364,0.203]    (0.203,0.428]    (0.428,0.705] 
#&gt;               20               20               20               20 
#&gt;     (0.705,1.25]      (1.25,2.68] 
#&gt;               20               20 </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>rsample is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Julia Silge, Fanny Chow, Max Kuhn, <a href='http://hadley.nz'>Hadley Wickham</a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


